% Chi-square test
%
% The chi-square test is used when you have discrete outcomes and want to
% test inferences about proportions of characteristics in the population.
% This test is useful when the sample size is relatively large.
%
% This code tests whether the proportion of handsome Yale neurons exceeds
%   the false-positive rate of 5% (alpha=0.05)
%
% We will test this as a function of different measured proportions and
%   the total number of neurons.
%
% Copyright 2019 by Yale E. Cohen
%   updated 4/25/21 by jig
%   udpated 8/15/25 by jig

%% Compute p values
%
N = logspace(1,3,10);
Proportion = (0.7:0.005:1.0);  % proportion of significant handsome neurons
ps = nan(length(N), length(Proportion));

% We are testing two frequencies, so df = 2-1 = 1
df=1;

% For each N (number of neurons)
for ii=1:length(N)
    % For each proportion
    for jj=1:length(Proportion)
        HandsomeYale=Proportion(jj).*N(ii); %i know you can't have fractions of neurons but we will do this here just for fun
        NonHandsomeJosh=N(ii)-HandsomeYale;
        TheoreticallyHandsome=0.95*N(ii);
        TheoreticallyNonHandsome=N(ii)-TheoreticallyHandsome;

        ChiSquare=(HandsomeYale-TheoreticallyHandsome).^2/TheoreticallyHandsome+...
            (NonHandsomeJosh-TheoreticallyNonHandsome)^2/TheoreticallyNonHandsome;
        ps(ii,jj)=1-chi2cdf(ChiSquare,df);
    end
end

%% Make a figure
figure

%% Plot probability per observed percentage for different N
%
cla reset; hold on;
plot([70 100],[0.05 0.05],'-','color',[1 0 0])
for ii=1:length(N)
    plot(Proportion.*100,ps(ii,:),'.-','markersize',15,'color',(ii-1)/length(N).*ones(3,1));
end
text(85,.3,['N=' num2str(N(1))])
text(94.5,.25,['N=' num2str(N(end))],'Color',0.99.*ones(3,1))
text(72, 0.08, 'P=0.05', 'Color', 'r')
set(gca,'fontsize',12);
xlabel('Percentage of HandsomeYale neurons')
ylabel('P(data | H_0)')
title('Probability of observed percentage for different N')